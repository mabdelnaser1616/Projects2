import cv2
import mediapipe as mp
import serial
import time

arduino = serial.Serial('COM3', 9600)
time.sleep(2) 

# MediaPipe
mp_hands = mp.solutions.hands
hands = mp_hands.Hands(min_detection_confidence=0.7, min_tracking_confidence=0.7)
mp_draw = mp.solutions.drawing_utils

# أسماء الأصابع
finger_names = [Thumb, Index, Middle, Ring, Pinky]

cap = cv2.VideoCapture(0)

def fingers_up(hand_landmarks)
    finger_tips = [4, 8, 12, 16, 20]
    finger_states = []
    for tip_idx in finger_tips
        if tip_idx == 4  # Thumb
            if hand_landmarks.landmark[tip_idx].x  hand_landmarks.landmark[tip_idx - 1].x
                finger_states.append(1)
            else
                finger_states.append(0)
        else
            if hand_landmarks.landmark[tip_idx].y  hand_landmarks.landmark[tip_idx - 2].y
                finger_states.append(1)
            else
                finger_states.append(0)
    return finger_states

while cap.isOpened()
    success, frame = cap.read()
    if not success
        break

    frame = cv2.flip(frame, 1)
    rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    result = hands.process(rgb_frame)

    if result.multi_hand_landmarks
        for hand_landmarks in result.multi_hand_landmarks
            mp_draw.draw_landmarks(frame, hand_landmarks, mp_hands.HAND_CONNECTIONS)

            fingers = fingers_up(hand_landmarks)

            # ابعت ل Arduino حالة الأصابع كـ 5 أرقام (0 أو 1)
            finger_str = ''.join(str(x) for x in fingers)
            arduino.write(finger_str.encode())

            # اظهر الأسماء على الشاشة
            for i, is_up in enumerate(fingers)
                if is_up
                    x = int(hand_landmarks.landmark[4 + i  4].x  frame.shape[1])
                    y = int(hand_landmarks.landmark[4 + i  4].y  frame.shape[0])
                    cv2.putText(frame, finger_names[i], (x - 30, y - 30), cv2.FONT_HERSHEY_SIMPLEX,
                                0.7, (0, 255, 0), 2)

            cv2.putText(frame, fRaised fingers {sum(fingers)},
                        (10, 50), cv2.FONT_HERSHEY_SIMPLEX, 1, (255, 0, 0), 2)

    cv2.imshow(Hand Detection, frame)

    if cv2.waitKey(1) & 0xFF == ord('q')
        break

cap.release()
arduino.close()
cv2.destroyAllWindows()
